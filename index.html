<!DOCTYPE html>
<html lang="da">
  <head>
    <meta charset="UTF-8" />
    <title>Fodboldspillet</title>
  </head>

  <body>
  <h1>Fodboldspillet</h1>

  <h3>Opret konto</h3>
  <input id="email" type="email" placeholder="Email" />
  <br />
  <input id="password" type="password" placeholder="Kodeord (min. 6 tegn)" />
  <br /><br />
  <button onclick="signUp()">Opret konto</button>

  <p id="status"></p>

  <!-- Supabase UMD (browser-version) -->
  <script src="https://unpkg.com/@supabase/supabase-js@2/dist/umd/supabase.js"></script>

  <script>
    // OPRET klienten (brug DINE rigtige værdier)
    const client = supabase.createClient(
      "https://xjgmwlzdpmulvvavnied.supabase.co",
      "sb_publishable_jzAF9XGA5S7rGRLDyyDHEg_cA0eZUli"
    );

    async function signUp() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;

      const { error } = await client.auth.signUp({
        email,
        password
      });

      document.getElementById("status").innerText =
        error ? error.message : "Konto oprettet!";
    }
     const client = supabase.createClient(
    "https://xjgmwlzdpmulvvavnied.supabase.co",
    "sb_publishable_jzAF9XGA5S7rGRLDyyDHEg_cA0eZUli"
  );

  async function signUp() {
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;

    const { data, error } = await client.auth.signUp({
      email,
      password
    });

    if (error) {
      document.getElementById("status").innerText = error.message;
      return;
    }

    document.getElementById("status").innerText = "Konto oprettet! Logger ind...";
  }

  async function ensurePlayer() {
    const {
      data: { user }
    } = await client.auth.getUser();

    if (!user) return;

    // Tjek om player allerede findes
    const { data: players } = await client
      .from("players")
      .select("id")
      .eq("user_id", user.id)
      .limit(1);

    if (players.length > 0) {
      console.log("Player findes allerede");
      return;
    }

    // Opret player
    const { error } = await client.from("players").insert({
      user_id: user.id
    });

    if (error) {
      console.error("Kunne ikke oprette player:", error.message);
    } else {
      console.log("Player oprettet!");
    }
  }

  // Kør når siden loader
  client.auth.onAuthStateChange((_event, session) => {
    if (session) {
      ensurePlayer();
    }
  });
  </script>
</body>
</html>
